# LinxISA v0.3 â€” Compiler / LLVM Codegen & Assembler Contracts

This reference keeps the LLVM backend aligned with the v0.3 ISA contract.

Canonical source-of-truth lives in the **linx-isa** repo:
- ISA manual: `docs/architecture/isa-manual/src/linxisa-isa-manual.adoc`
- TEPL catalog seed: `isa/v0.3/state/engine_ops.json`
- Bring-up decision index: `docs/bringup/plan/isa_clarifications.md`

---

## 1) TEPL TileOp10 encodings (strict v0.3)

Key assignments that MUST match LLVM aliases/whitelists/InstPrinter:

- `TCOLEXPAND = 0x0C0` (legacy `0x027` must be rejected in strict mode)
- `TROWEXPAND = 0x0C1`

TOPS (tile-scalar, kind=0x1, func mirrors tile-tile):

- `TADDS=0x040`, `TSUBS=0x041`, `TMULS=0x042`, `TDIVS=0x043`, `TMAXS=0x044`, `TMINS=0x045`,
  `TANDS=0x046`, `TORS=0x047`, `TXORS=0x048`, `TSHLS=0x049`, `TSHRS=0x04A`.

Conventions (compiler-visible):
- TOPS scalar RHS comes from `B.IOR` (required), broadcast.
- Scalar RHS type/signedness matches tile element dtype; extraction is low-bit truncation.

---

## 2) Strict whitelist policy

- If an encoding is marked non-canonical in strict v0.3, LLVM should reject it (AsmParser and/or IR-lowering constraints).
- Prefer explicit comments in:
  - AsmParser alias tables
  - ISel/Blockify TEPL whitelists
  - InstPrinter mnemonic mapping

---

## 3) Regression tests to add/keep

- Assembler acceptance:
  - accepts `BSTART.TCOLEXPAND` -> emits `TileOp10=0x0C0`
  - accepts `BSTART.TROWEXPAND` -> emits `TileOp10=0x0C1`
  - rejects numeric `0x027` (strict)
- Printer stability:
  - prints `BSTART.TCOLEXPAND` for `0x0C0`
  - prints `BSTART.TROWEXPAND` for `0x0C1`

---

## 4) Quick cross-check commands

From linx-isa superproject:

```bash
python3 tools/isa/validate_spec.py --profile v0.3
python3 tools/bringup/check_tepl_encoding.py --root .
```

From llvm-project:

```bash
# grep aliases / whitelist
rg -n "TCOLEXPAND|TROWEXPAND|0x027|0x0C0|0x0C1" llvm/lib/Target/LinxISA
```
